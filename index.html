<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <title>Miners Excel Viewer (HTML)</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    .row { display: flex; align-items: center; gap: 10px; flex-wrap: wrap; }
    button, select { padding: 8px 12px; }
    #status { margin-left: 10px; }
    .muted { color: #666; font-size: 12px; }
    iframe { width: 100%; height: 78vh; border: 1px solid #ddd; margin-top: 12px; }
    code { background: #f5f5f5; padding: 2px 4px; border-radius: 4px; }
  </style>
</head>
<body>
  <h2>Excel Viewer (HTML export)</h2>

  <div class="row">
    <label for="sheetSelect"><b>Sheet:</b></label>
    <select id="sheetSelect"></select>

    <button id="reloadBtn">Reload list</button>
    <span id="status" class="muted"></span>
  </div>

  <div style="margin-top:10px;">
    <span class="muted">
      Expected files under: <code>data/sheets_html/*.html</code>
    </span>
  </div>

  <iframe id="viewer" src=""></iframe>

<script>
  // ====== configure this to match your repo structure ======
  // Put your exported sheet HTML files into: <repo>/data/sheets_html/
  const SHEETS_DIR = "data/sheets_html/";

  // Fill in the exported HTML file names (no folders, just filenames)
  // Example output names from your exporter are safe_name.html
  const SHEET_FILES = [
    "Golds.html",
    "Golds Colour.html",
    "Copper.html",
    "Copper Colour.html",
    "Silver.html", 
	  "Silver Colour.html", 
	  "Diversifieds.html", 
	  "Diversifieds Colour.html", 
	  "PGMs.html", 
	  "Iron Ore.html", 
	  "Uranium.html", 
	  "Lithium.html", 
	  "Other.html", 
	  "Coal.html", 
	  "O&G.html", 
	  "Aluminium.html"

  ];

  function setStatus(msg) {
    document.getElementById("status").innerText = msg || "";
  }

  function populate() {
    const sel = document.getElementById("sheetSelect");
    sel.innerHTML = "";

    if (!SHEET_FILES.length) {
      const opt = document.createElement("option");
      opt.value = "";
      opt.textContent = "(Fill SHEET_FILES in index.html)";
      sel.appendChild(opt);
      setStatus("No sheets configured in index.html.");
      return;
    }

    for (const f of SHEET_FILES) {
      const opt = document.createElement("option");
      opt.value = f;
      opt.textContent = f.replace(/\.html$/i, "");
      sel.appendChild(opt);
    }
    setStatus("");
  }

  async function checkExists(url) {
    const r = await fetch(url, { method: "HEAD", cache: "no-store" });
    return r.ok;
  }

  async function loadSelected() {
    const sel = document.getElementById("sheetSelect");
    const file = sel.value;
    if (!file) return;

    const url = SHEETS_DIR + file;
    setStatus("Checking file path...");

    // Local verification: HEAD request should be 200
    // Note: Some local servers may not support HEAD; in that case it falls back to loading iframe anyway.
    try {
      const ok = await checkExists(url);
      if (!ok) {
        setStatus(`Not found: ${url} (check path / filename)`);
      } else {
        setStatus("");
      }
    } catch (e) {
      // ignore HEAD errors on simple local servers
      setStatus("");
    }

    document.getElementById("viewer").src = url;
  }

  document.getElementById("sheetSelect").addEventListener("change", loadSelected);
  document.getElementById("reloadBtn").addEventListener("click", () => {
    populate();
    loadSelected();
  });

  // init
  populate();
  if (SHEET_FILES.length) loadSelected();
</script>
</body>
</html>
